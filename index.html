<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VLearn</title>
<link rel="icon" type="image/png" href="Logo.png">
<style>
  /* ============ COLOR / FONT VARIABLES ============ */
  :root{
    --bg: #e6f5ff;
    --fg: #003a66;
    --muted: rgba(0,0,0,0.45);
    --accent: #0077cc;
    --nav-bg: rgba(255,255,255,0.9);
    --nav-fg: #001f3f;
    --dropdown-bg: #fff;
    --star-color: #ffffff;
    --star-moving: 1; /* 1 => moving, 0 => flicker only */
  }
  html,body{ height:100%; margin:0; padding:0; }
  body{ font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--fg); overflow:hidden; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

  /* full app */
  .app{ height:100vh; width:100vw; position:relative; }

  /* generic screen sections (loader/intro/rick/space) */
  .screen{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center; z-index:5; }
  .hidden{ display:none !important; }

  /* --- LOADER --- */
  .loader-card{ width:86%; max-width:780px; padding:24px; border-radius:14px; backdrop-filter: blur(6px); background:rgba(255,255,255,0.84); box-shadow:0 18px 36px rgba(2,6,23,0.08); }
  .logo-title{ font-family: "Merriweather", serif; font-size:24px; color:var(--fg); margin:0 0 8px; }
  .loader-sub{ color:var(--muted); font-size:14px; margin-bottom:12px; }
  .loader-bar{ width:100%; height:12px; background: #e6f3fb; border-radius:8px; overflow:hidden; }
  .loader-bar .fill{ width:0; height:100%; background:linear-gradient(90deg,var(--accent), #7edbff); animation:fillAnim 4s linear forwards; border-radius:8px; }
  @keyframes fillAnim { from{width:0} to{width:100%} }

  /* theme control (top-right) */
  .theme-btn{ position:fixed; top:14px; right:14px; z-index:120; background:rgba(0,0,0,0.56); color:#fff; border:0; padding:10px 12px; border-radius:10px; cursor:pointer; display:flex; gap:8px; align-items:center; font-weight:700; }
  .theme-panel{ position:fixed; top:56px; right:14px; z-index:125; display:none; background:var(--nav-bg); color:var(--nav-fg); border-radius:10px; padding:10px; box-shadow:0 12px 28px rgba(0,0,0,0.12); min-width:220px; }
  .theme-panel button{ display:block; width:100%; padding:10px 12px; border:0; background:transparent; text-align:left; cursor:pointer; font-weight:700; border-radius:6px; margin:4px 0; color:var(--nav-fg); }
  .theme-panel button:hover{ background:rgba(0,0,0,0.04); }

  /* --- INTRO (new) --- */
  #intro {
    background: #0db24a; /* green background specified */
    color: #000;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    position:relative;
    z-index:60;
  }

  .intro-stage {
    width:92%;
    max-width:960px;
    height:360px;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:visible;
  }

  /* Big V (black) and small V (cyan) */
  .big-V, .small-V {
    font-family: "Merriweather", serif;
    font-size: 220px;
    line-height: 1;
    font-weight: 900;
    letter-spacing: -6px;
    position:absolute;
    user-select:none;
    transform-origin:center center;
    will-change: transform, opacity;
  }
  .big-V { color:#000; font-size:280px; } /* larger */
  .small-V { color:#00ffff; font-size:120px; } /* cyan smaller */

  /* initial offscreen positions and animation */
  .big-V.init { transform: translateY(120vh) scale(0.9) rotate(-8deg); opacity:0; }
  .small-V.init { transform: translateY(-120vh) scale(0.9) rotate(8deg); opacity:0; }

  /* comeIntoCenter - both animate to center */
  @keyframes bigRise {
    0% { transform: translateY(120vh) scale(0.95) rotate(-8deg); opacity:0; }
    70% { transform: translateY(0) scale(1.02) rotate(-2deg); opacity:1; }
    100% { transform: translateY(0) scale(1) rotate(0deg); opacity:1; }
  }
  @keyframes smallDrop {
    0% { transform: translateY(-120vh) scale(0.8) rotate(8deg); opacity:0; }
    70% { transform: translateY(6%) scale(1.06) rotate(2deg); opacity:1; }
    100% { transform: translateY(0) scale(1) rotate(0deg); opacity:1; }
  }

  /* subtle lock / pop when they merge */
  @keyframes lockPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.06); }
    100% { transform: scale(1); }
  }

  .merged .big-V, .merged .small-V { animation: lockPulse 320ms ease 1; }

  /* welcome text fades in */
  .intro-text {
    font-weight:700;
    font-size:20px;
    margin-top:18px;
    opacity:0;
    transform: translateY(8px);
    transition: opacity 420ms ease, transform 420ms ease;
    color: #001f3f;
  }
  .intro-text.visible { opacity:1; transform:translateY(0); }

  /* pencil and fountain pen elements */
  .pencil, .fountain {
    position:absolute;
    width:220px;
    height:18px;
    transform-origin: left center;
    display:block;
    opacity:0;
    will-change: transform, opacity;
  }

  /* pencil graphic (simple rectangle + tip) - coming from right at 45deg */
  .pencil {
    right:-260px;
    bottom:-80px;
    transform: rotate(-45deg) translate3d(0,0,0);
  }
  .pencil .body { height:100%; width:100%; background: linear-gradient(90deg,#ffd54a,#ffb74d); border-radius:6px; display:block; }
  .pencil .tip { position:absolute; right:-22px; top:-6px; width:0; height:0; border-left:22px solid #6b6b6b; border-top:12px solid transparent; border-bottom:12px solid transparent; }

  @keyframes pencilIn {
    0% { transform: translate3d(120px,120px,0) rotate(-45deg); opacity:0; }
    60% { transform: translate3d(-20px,-20px,0) rotate(-45deg); opacity:1; }
    100% { transform: translate3d(0,0,0) rotate(-45deg); opacity:1; }
  }

  /* fountain pen - coming from top-left to bottom-right (slash) */
  .fountain {
    left:-260px;
    top:-120px;
    width:260px;
    height:18px;
    transform: rotate(28deg);
  }
  .fountain .body { height:100%; width:100%; background: linear-gradient(90deg,#0a0a0a,#444); border-radius:6px; display:block; }
  .fountain .nib { position:absolute; right:-16px; top:-4px; width:0; height:0; border-left:18px solid #0a0a0a; border-top:8px solid transparent; border-bottom:8px solid transparent; transform: rotate(20deg); }

  @keyframes fountainIn {
    0% { transform: translate3d(-160px,-160px,0) rotate(28deg); opacity:0; }
    60% { transform: translate3d(20px,20px,0) rotate(28deg); opacity:1; }
    100% { transform: translate3d(0,0,0) rotate(28deg); opacity:1; }
  }

  /* ink slash - drawn with pseudo element (animated scaleX) */
  .ink-slash {
    position:absolute;
    width:2px;
    height:0;
    left:50%;
    top:50%;
    transform-origin: top left;
    background: linear-gradient(180deg,#032a61,#0b3b85);
    opacity:0;
    border-radius:6px;
  }
  @keyframes slashGrow {
    0% { height:0; opacity:0; transform: rotate(25deg) scaleY(0); }
    60% { height:360px; opacity:1; transform: rotate(25deg) scaleY(1.06); }
    100% { height:360px; opacity:1; transform: rotate(25deg) scaleY(1); }
  }

  /* ink pools / splatter */
  .ink-pool {
    position:absolute;
    background:#062d6f;
    width:8px; height:8px;
    border-radius:50%;
    opacity:0;
    transform: scale(0.2);
  }
  @keyframes inkPop {
    0% { opacity:0; transform: scale(0.2); }
    60% { opacity:1; transform: scale(1.05); }
    100% { opacity:1; transform: scale(1); }
  }

  /* small accessibility: reduce motion */
  @media (prefers-reduced-motion: reduce) {
    .big-V, .small-V, .pencil, .fountain, .ink-slash, .ink-pool { animation: none !important; transition:none !important; opacity:1 !important; transform:none !important; }
  }

  /* --- RICKROLL --- */
  #rick{ background:#000; }
  #rick video{ width:100%; height:100%; object-fit:cover; }

  /* --- SPACE / STARFIELD --- */
  #space{ position:relative; inset:0; width:100%; height:100%; background:#000; color:#fff; overflow:hidden; display:flex; align-items:flex-start; justify-content:center; padding-top:18px; }
  canvas#stars{ position:absolute; inset:0; width:100%; height:100%; z-index:10; display:block; }
  .glitch-bg{ position:absolute; inset:0; z-index:6; background: linear-gradient(120deg,#000,#ff0022,#fff,#00f7ff); background-size:400% 400%; animation:glow 8s linear infinite; opacity:0.95; mix-blend-mode:screen; }
  @keyframes glow{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }

  /* ============ NAV BAR (Image 2 style) ============ */
  .navbar {
    display:flex;
    align-items:center;
    justify-content:space-between; /* left/right groups */
    background:var(--nav-bg);
    color:var(--nav-fg);
    border-radius:28px;
    overflow: visible;              /* allow dropdowns to show */
    width:92%;
    max-width:1200px;
    padding:8px 12px;
    margin:10px auto;
    z-index:120; /* above canvas */
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    position:relative;
  }

  .nav-left, .nav-right { display:flex; align-items:center; gap:8px; }

  .brand { font-weight:900; letter-spacing:0.6px; color:var(--nav-fg); text-decoration:none; padding:8px 12px; font-size:18px; }

  .nav-links{ list-style:none; display:flex; gap:6px; margin:0; padding:0; align-items:center; }
  .nav-links li{ position:relative; }
  .nav-links a, .nav-links button.dropbtn {
    color:var(--nav-fg); text-decoration:none; padding:10px 14px; border-radius:8px; background:transparent; border:0; font-weight:700; cursor:pointer;
  }
  .nav-links a:hover, .nav-links button.dropbtn:hover{ background: rgba(0,0,0,0.04); }

  /* dropdown */
  .dropdown { position:relative; }
  .dropdown-content {
    display:none;
    position:absolute;
    top:calc(100% + 8px);
    left:0;
    background:var(--dropdown-bg);
    min-width:180px;
    box-shadow:0 10px 28px rgba(0,0,0,0.15);
    border-radius:8px;
    z-index:9999;
    overflow:hidden;
  }
  .dropdown-content a {
    padding:12px 14px; display:block; color:var(--nav-fg); text-decoration:none; font-weight:700; white-space:nowrap;
  }
  .dropdown-content a:hover{ background:rgba(0,0,0,0.04); }
  .dropdown:hover > .dropdown-content{ display:block; } /* hover for desktop */

  /* locked style */
  .locked{ opacity:0.45; cursor:pointer; }

  /* small responsive */
  @media (max-width:900px){
    .navbar{ flex-direction:column; gap:10px; align-items:stretch; padding:12px; }
    .nav-right{ justify-content:flex-end; }
    .nav-links a, .nav-links button.dropbtn { padding:10px 12px; font-size:15px; }
    .dropdown-content { min-width:140px; left:8px; }
  }

  /* small helper: content area under nav (so page isn't empty) */
  .page-content-placeholder{ width:92%; max-width:1200px; margin:18px auto; background: rgba(255,255,255,0.02); min-height:320px; border-radius:12px; z-index:20; position:relative; padding:18px; color:var(--nav-fg); }

  /* modal for locked message (nice) */
  .modal {
    position:fixed; top:0; left:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; z-index:200;
    background: rgba(0,0,0,0.45); visibility:hidden; opacity:0; transition:opacity .18s ease;
  }
  .modal.show{ visibility:visible; opacity:1; }
  .modal .card{
    background:var(--nav-bg); color:var(--nav-fg); padding:22px; border-radius:10px; box-shadow:0 12px 36px rgba(0,0,0,0.2); max-width:420px; text-align:center;
  }
  .modal .card button{ margin-top:12px; padding:8px 12px; font-weight:700; border-radius:8px; border:0; cursor:pointer; }

  /* small typography */
  h1,h2,h3,p{ margin:0; padding:0; }

</style>
</head>
<body>
<div id="app" class="app" aria-live="polite">
  <!-- Theme control -->
  <button class="theme-btn" id="themeBtn" aria-label="Theme selector">Theme</button>
  <div class="theme-panel" id="themePanel" role="dialog" aria-hidden="true">
    <div style="font-weight:900;margin-bottom:8px;">Choose theme</div>
    <button data-theme="dark">Dark</button>
    <button data-theme="light">Light</button>
    <button data-theme="retro">Retro DOS</button>
    <button data-theme="radio">Radioactive</button>
    <button data-theme="lava">Lava</button>
    <button data-theme="glitch">Glitched</button>
    <button data-theme="sgs">SGS</button>
  </div>

  <!-- Loading (4s) -->
  <section id="loading" class="screen" aria-hidden="false">
    <div class="loader-card" role="status">
      <div class="logo-title">VLearn</div>
      <div class="loader-sub">Loading the VLearn Directory — please wait</div>
      <div class="loader-bar" aria-hidden="true"><div class="fill"></div></div>
      <div class="loader-meta" style="margin-top:10px; color:var(--muted);">Preparing answers • Aligning chapters • Applying finishing touches</div>
    </div>
  </section>

  <!-- Intro (new) -->
  <section id="intro" class="screen hidden" aria-hidden="true">
    <div class="intro-stage" aria-hidden="false" role="img" aria-label="VLearn Intro animation">
      <div id="vWrapper" style="position:relative; width:540px; height:260px; display:flex; align-items:center; justify-content:center;">
        <div class="big-V init" id="bigV">V</div>
        <div class="small-V init" id="smallV">V</div>

        <!-- pencil -->
        <div class="pencil" id="pencil" aria-hidden="true">
          <span class="body"></span>
          <span class="tip"></span>
        </div>

        <!-- fountain pen -->
        <div class="fountain" id="fountain" aria-hidden="true">
          <span class="body"></span>
          <span class="nib"></span>
        </div>

        <!-- ink slash -->
        <div class="ink-slash" id="slash" aria-hidden="true"></div>

        <!-- ink pools (3 spots) -->
        <div class="ink-pool" id="pool1" style="left:58%; top:62%; width:18px;height:18px;border-radius:50%;"></div>
        <div class="ink-pool" id="pool2" style="left:64%; top:72%; width:28px;height:28px;border-radius:50%;"></div>
        <div class="ink-pool" id="pool3" style="left:50%; top:78%; width:20px;height:20px;border-radius:50%;"></div>
      </div>

      <div class="intro-text" id="introText">Welcome to VLearn Web App</div>
    </div>
  </section>

  <!-- Rickroll (3s) -->
  <section id="rick" class="screen hidden" aria-hidden="true">
    <video id="rickVideo" src="rickroll.mp4" playsinline preload="auto"></video>
  </section>

  <!-- Space with starfield & nav bar (final stage) -->
  <section id="space" class="screen hidden" aria-hidden="true">
    <div id="glitchBg" class="glitch-bg" style="display:none;"></div>
    <canvas id="stars"></canvas>

    <!-- NAV BAR (grouped left & right) -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
      <div class="nav-left">
        <a href="index.html" class="brand">VLEARN</a>

        <ul class="nav-links">
          <li class="dropdown">
            <button class="dropbtn">SUBJECTS ▾</button>
            <ul class="dropdown-content" id="subjectsDrop">
              <li><a href="hindi.html">Hindi</a></li>
              <li><a href="#" class="locked">English</a></li>
              <li><a href="#" class="locked">Maths</a></li>
              <li><a href="#" class="locked">Science</a></li>
              <li><a href="#" class="locked">SST</a></li>
            </ul>
          </li>

          <li><a href="#" >PRACTICE SHEET</a></li>
          <li><a href="#" >ANSWER KEY</a></li>
        </ul>
      </div>

      <div class="nav-right">
        <ul class="nav-links">
          <li><a href="copyright.html" >Copyright(c)</a></li>
          <li><a href="aboutus.html" >About Us</a></li>
          <li><a href="credits.html" >Credit</a></li>
        </ul>
      </div>
    </nav>

    <!-- page placeholder below nav -->
    <div class="page-content-placeholder" id="pageContent">
      <!-- You can load content dynamically or navigate to other pages -->
      <h2 style="font-size:22px; margin-bottom:10px; color:var(--nav-fg);">VLearn Directory</h2>
      <p style="color:var(--muted);">Choose a subject from the menu to continue. Locked items show a "Locked for now" message.</p>
    </div>
  </section>

  <!-- Locked modal -->
  <div class="modal" id="modalLocked" role="dialog" aria-modal="true">
    <div class="card">
      <h3 style="margin-bottom:8px;">LOCKED FOR NOW</h3>
      <p>COMING SOON</p>
      <button id="modalClose">OK</button>
    </div>
  </div>
</div>

<script>
/* ============ ORCHESTRATION & THEME + STARFIELD ============ */
(function(){
  // elements
  const app = document.getElementById('app');
  const loading = document.getElementById('loading');
  const intro = document.getElementById('intro');
  const rick = document.getElementById('rick');
  const space = document.getElementById('space');
  const rickVideo = document.getElementById('rickVideo');
  const themeBtn = document.getElementById('themeBtn');
  const themePanel = document.getElementById('themePanel');
  const modalLocked = document.getElementById('modalLocked');
  const modalClose = document.getElementById('modalClose');

  // elements for intro animation
  const bigV = document.getElementById('bigV');
  const smallV = document.getElementById('smallV');
  const vWrapper = document.getElementById('vWrapper');
  const introText = document.getElementById('introText');
  const pencil = document.getElementById('pencil');
  const fountain = document.getElementById('fountain');
  const slash = document.getElementById('slash');
  const pool1 = document.getElementById('pool1');
  const pool2 = document.getElementById('pool2');
  const pool3 = document.getElementById('pool3');

  // theme & starfield code unchanged from your original file (compressed for readability)
  const THEMES = {
    dark: {
      '--bg':'#000000', '--fg':'#bfefff','--muted':'rgba(255,255,255,0.6)','--accent':'#6ee7ff',
      navBg:'rgba(0,0,0,0.76)', navFg:'#dff8ff', dropdown:'#111',
      spaceBg:'#000000', star:'#ffffff', starMoving:1, glitch:false
    },
    light: {
      '--bg':'#ffffff', '--fg':'#003a66','--muted':'rgba(0,0,0,0.45)','--accent':'#0077cc',
      navBg:'rgba(255,255,255,0.95)', navFg:'#003a66', dropdown:'#fff',
      spaceBg:'#ffffff', star:'#001f3f', starMoving:1, glitch:false
    },
    retro: {
      '--bg':'#001a33', '--fg':'#ffffff','--muted':'rgba(255,255,255,0.85)','--accent':'#66ffff',
      navBg:'rgba(0,26,51,0.92)', navFg:'#fff', dropdown:'#001a33',
      spaceBg:'#001a33', star:'#ffffff', starMoving:0.2, glitch:false
    },
    radio: {
      '--bg':'#d6ff7a','--fg':'#2f7f00','--muted':'rgba(0,0,0,0.35)','--accent':'#6bd400',
      navBg:'rgba(230,255,170,0.95)', navFg:'#164a00', dropdown:'#eaffb8',
      spaceBg:'#d6ff7a', star:'#2f7f00', starMoving:1, glitch:false
    },
    lava: {
      '--bg':'linear-gradient(180deg,#ffd84d,#ff7a00)','--fg':'#6b0000','--muted':'rgba(0,0,0,0.45)','--accent':'#ff6a00',
      navBg:'rgba(255,230,170,0.95)', navFg:'#6b0000', dropdown:'#ffe7b0',
      spaceBg:'#ffd84d', star:'#6b0000', starMoving:1, glitch:false
    },
    glitch: {
      '--bg':'#050406','--fg':'#e6f7ff','--muted':'rgba(255,255,255,0.6)','--accent':'#00ffff',
      navBg:'rgba(2,2,2,0.85)', navFg:'#e6f7ff', dropdown:'#070707',
      spaceBg:'glitch', starNeg:['#ffffff','#00ffff','#000000','#ff0000'], starMoving:0, glitch:true
    },
    sgs: {
      '--bg':'linear-gradient(180deg,#061235,#0b2b45)','--fg':'#ffffff','--muted':'rgba(255,255,255,0.85)','--accent':'#ffb86b',
      navBg:'rgba(6,18,53,0.9)', navFg:'#fff', dropdown:'#05213b',
      spaceBg:'#061235', star:'#ff8a3d', starMoving:1, glitch:false
    }
  };

  function applyTheme(name){
    const cfg = THEMES[name] || THEMES.light;
    Object.keys(cfg).forEach(k=>{
      if(k.startsWith('--')) document.documentElement.style.setProperty(k, cfg[k]);
    });
    document.documentElement.style.setProperty('--nav-bg', cfg.navBg);
    document.documentElement.style.setProperty('--nav-fg', cfg.navFg);
    document.documentElement.style.setProperty('--dropdown-bg', cfg.dropdown || cfg.navBg);
    currentTheme = name;
    localStorage.setItem('vlearn-theme', name);
    if(!space.classList.contains('hidden')) restartStarfield();
    document.getElementById('glitchBg').style.display = cfg.glitch ? 'block' : 'none';
  }

  themeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); themePanel.style.display = themePanel.style.display === 'block' ? 'none' : 'block'; });
  document.addEventListener('click', (e)=>{ if(themePanel.style.display === 'block' && !themePanel.contains(e.target) && e.target !== themeBtn) themePanel.style.display='none'; });
  document.querySelectorAll('.theme-panel button').forEach(b => b.addEventListener('click', ()=> applyTheme(b.getAttribute('data-theme')) ) );

  let currentTheme = localStorage.getItem('vlearn-theme') || 'light';
  applyTheme(currentTheme);

  /* ============ STARFIELD (same as original) ============ */
  const STAR_DENSITY = 4000;
  let starAnimationStop = null;

  function startStarfield(){
    stopStarfield();
    const cfg = THEMES[currentTheme] || THEMES.light;
    const canvas = document.getElementById('stars');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(cfg.spaceBg === 'glitch'){ document.getElementById('glitchBg').style.display = 'block'; canvas.style.background = '#000'; }
    else { document.getElementById('glitchBg').style.display = 'none'; canvas.style.background = cfg.spaceBg || cfg.spaceBg; canvas.style.background = cfg.spaceBg; }

    const stars = [];
    if(cfg.glitch && Array.isArray(cfg.starNeg)){
      for(let i=0;i<STAR_DENSITY;i++){
        stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.6+0.6, color: cfg.starNeg[Math.floor(Math.random()*cfg.starNeg.length)], delay: Math.random()*1400 });
      }
      let raf;
      function loop(t){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        stars.forEach(s=>{
          const v = Math.abs(Math.sin((t + s.delay)*0.004 + s.r));
          if(v > 0.6){
            ctx.fillStyle = s.color;
            ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill();
          }
        });
        raf = requestAnimationFrame(loop);
      }
      raf = requestAnimationFrame(loop);
      starAnimationStop = ()=>{ cancelAnimationFrame(raf); ctx.clearRect(0,0,canvas.width,canvas.height); };
    } else if(cfg.starMoving && cfg.starMoving < 1){
      for(let i=0;i<STAR_DENSITY;i++){
        stars.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.6+0.3 });
      }
      const id = setInterval(()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        stars.forEach(s=>{
          s.x += (Math.random()-0.5)*3;
          s.y += (Math.random()-0.5)*3;
          if(s.x < 0) s.x = canvas.width; if(s.x > canvas.width) s.x = 0;
          if(s.y < 0) s.y = canvas.height; if(s.y > canvas.height) s.y = 0;
          ctx.fillStyle = cfg.star || '#fff';
          ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
        });
      }, 200);
      starAnimationStop = ()=>{ clearInterval(id); ctx.clearRect(0,0,canvas.width,canvas.height); };
    } else {
      for(let i=0;i<STAR_DENSITY;i++){
        stars.push({
          x:Math.random()*canvas.width,
          y:Math.random()*canvas.height,
          r:Math.random()*1.6+0.2,
          vx:(Math.random()*0.6-0.3)*(0.5+Math.random()*0.8),
          vy:(Math.random()*0.6-0.3)*(0.5+Math.random()*0.8),
          alpha: Math.random()*0.7+0.2,
          color: cfg.star || '#fff'
        });
      }
      let raf;
      function loop(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        stars.forEach(s=>{
          s.x += s.vx; s.y += s.vy;
          if(s.x < 0) s.x = canvas.width; if(s.x > canvas.width) s.x = 0;
          if(s.y < 0) s.y = canvas.height; if(s.y > canvas.height) s.y = 0;
          ctx.globalAlpha = s.alpha;
          ctx.fillStyle = s.color;
          ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
        });
        ctx.globalAlpha = 1;
        raf = requestAnimationFrame(loop);
      }
      raf = requestAnimationFrame(loop);
      starAnimationStop = ()=>{ cancelAnimationFrame(raf); ctx.clearRect(0,0,canvas.width,canvas.height); };
    }

    window.addEventListener('resize', ()=>{ canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
  }

  function stopStarfield(){ if(typeof starAnimationStop === 'function'){ try{ starAnimationStop(); }catch(e){} starAnimationStop = null; } }
  function restartStarfield(){ stopStarfield(); startStarfield(); }

  /* ============ NAV LOCKS & modal ============ */
  function showLocked(){ modalLocked.classList.add('show'); }
  modalClose.addEventListener('click', ()=> modalLocked.classList.remove('show') );
  document.querySelectorAll('.locked').forEach(l => l.addEventListener('click', (ev)=>{ ev.preventDefault(); showLocked(); }) );

  /* ============ DROPDOWN CLICK/TAP SUPPORT (mobile friendly) ============ */
  (function(){
    document.querySelectorAll('.dropdown .dropbtn').forEach(btn=>{
      btn.addEventListener('click', function(e){
        e.preventDefault();
        e.stopPropagation();
        const panel = btn.parentElement.querySelector('.dropdown-content');
        if(!panel) return;
        const isOpen = panel.style.display === 'block';
        document.querySelectorAll('.dropdown .dropdown-content').forEach(p => p.style.display = 'none');
        panel.style.display = isOpen ? 'none' : 'block';
      });
    });
    document.addEventListener('click', function(){ document.querySelectorAll('.dropdown .dropdown-content').forEach(p => p.style.display = 'none'); });
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') document.querySelectorAll('.dropdown .dropdown-content').forEach(p => p.style.display = 'none'); });
  })();

  /* ============ SEQUENCE: loading -> intro -> rick -> space ============ */
  loading.classList.remove('hidden'); intro.classList.add('hidden'); rick.classList.add('hidden'); space.classList.add('hidden');

  // After loader (4s) show intro
  setTimeout(()=> {
    loading.classList.add('hidden');
    intro.classList.remove('hidden');

    // run intro animation timeline via JS (so we can control exact sequencing)
    runIntroSequence();
  }, 4000);

  // play rickroll then show space (as before)
  function gotoRickThenSpace(){
    intro.classList.add('hidden');
    rick.classList.remove('hidden');
    (async ()=>{
      try{ await rickVideo.play(); } catch(e){ try{ rickVideo.muted=true; await rickVideo.play(); }catch(e){} }
    })();

    setTimeout(()=> {
      try{ rickVideo.pause(); rickVideo.currentTime = 0; } catch(e){}
      rick.classList.add('hidden');
      space.classList.remove('hidden');
      applyTheme(currentTheme);
      startStarfield();
    }, 3000); // 3s for rick segment (unchanged)
  }

  /* ============ Intro animation timeline implementation ============ */
  function runIntroSequence(){
    // Reset states
    bigV.classList.remove('merged'); smallV.classList.remove('merged');
    bigV.classList.add('init'); smallV.classList.add('init');
    introText.classList.remove('visible');
    pencil.style.opacity = 0; fountain.style.opacity = 0; slash.style.opacity = 0;
    [pool1,pool2,pool3].forEach(p => { p.style.opacity = 0; p.style.transform = 'scale(0.2)'; });

    // small timing constants (ms)
    const bigStart = 150;        // start after a short delay
    const bigDuration = 900;     // rise duration
    const smallStart = 280;      // small drops slightly later
    const smallDuration = 900;
    const lockDelay = Math.max(bigStart + bigDuration, smallStart + smallDuration) + 120; // after both landed
    const textDelay = lockDelay + 240;
    const pencilDelay = lockDelay + 380;
    const fountainDelay = lockDelay + 520;
    const slashDelay = fountainDelay + 520;
    const inkDelay = slashDelay + 220;
    const finishDelay = inkDelay + 900; // then go to rick

    // animate big V: use CSS keyframes by setting inline animation
    bigV.style.animation = `bigRise ${bigDuration}ms cubic-bezier(.2,.8,.2,1) ${bigStart}ms both`;
    smallV.style.animation = `smallDrop ${smallDuration}ms cubic-bezier(.2,.8,.2,1) ${smallStart}ms both`;

    // after they land, make merged pulse (toggle a class)
    setTimeout(()=> {
      bigV.classList.remove('init');
      smallV.classList.remove('init');
      // add merged class on wrapper to trigger lock pulse
      vWrapper.classList.add('merged');
      // remove after pulse
      setTimeout(()=> vWrapper.classList.remove('merged'), 380);
    }, lockDelay);

    // show welcome text
    setTimeout(()=> {
      introText.classList.add('visible');
    }, textDelay);

    // pencil animation in from right at 45deg
    setTimeout(()=> {
      pencil.style.opacity = 1;
      pencil.style.animation = `pencilIn 700ms cubic-bezier(.22,.9,.3,1) forwards`;
    }, pencilDelay);

    // fountain pen animation (top-left to bottom-right)
    setTimeout(()=> {
      fountain.style.opacity = 1;
      fountain.style.animation = `fountainIn 700ms cubic-bezier(.22,.9,.3,1) forwards`;
    }, fountainDelay);

    // draw slash (grow)
    setTimeout(()=> {
      // position slash roughly along fountain pen path
      slash.style.left = '46%';
      slash.style.top = '42%';
      slash.style.opacity = 1;
      slash.style.animation = `slashGrow 420ms cubic-bezier(.2,.9,.2,1) forwards`;
      // also darken smallV to show ink crossing (optional)
      smallV.style.filter = 'brightness(0.95)';
    }, slashDelay);

    // ink pools pop
    setTimeout(()=> {
      const pops = [pool1,pool2,pool3];
      pops.forEach((p, i) => {
        setTimeout(()=> {
          p.style.animation = `inkPop 360ms cubic-bezier(.2,.9,.2,1) forwards`;
          p.style.opacity = 1;
        }, i*120);
      });
    }, inkDelay);

    // proceed to rick then homepage after finishDelay
    setTimeout(()=> {
      gotoRickThenSpace();
    }, finishDelay);
  }

  // Expose runIntroSequence globally for quick testing (dev)
  window.runIntroSequence = runIntroSequence;

  // clean up starfield on unload
  window.addEventListener('beforeunload', ()=> stopStarfield());

})();
</script>
</body>
</html>
